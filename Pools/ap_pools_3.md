# 2025-2026年ETF版图演变（番外篇）：引入指数跟踪，优化聚类精度

在上一篇关于[2025-2026年ETF版图演变](file:///c:/Users/84066/Documents/Quan/jqtrade/Pools/ap_pools_2.md)的分析中，我们探讨了核心资产的稳定性。春节期间，在翻阅 JoinQuant 的 API 文档时，我偶然发现可以通过 [etf跟踪指数信息](https://www.joinquant.com/help/api/help#fund:%E8%8E%B7%E5%8F%96etf%E8%B7%9F%E8%B8%AA%E6%8C%87%E6%95%B0%E4%BF%A1%E6%81%AF) 接口获取 ETF 对应的底层指数信息。

这一发现为我们的 ETF 聚类逻辑提供了极大的优化空间。例如，沪深300指数下挂钩了众多由不同基金公司发行的 ETF，它们的走势高度一致。通过识别并采用跟踪不同指数的 ETF 进行初步过滤，我们可以显著降低数据的冗余度，从而让聚类算法更聚焦于跨指数、跨风格的本质差异，进一步提升分析的精度。

### 指数过滤逻辑升级

![img](/asserts/query_index.png)

根据接口返回表格中的 `traced_index_name` 和 `traced_index_code` 两个字段，我们可以精准识别 ETF 所跟踪的指数。针对国内 ETF 市场及其多样化的跟踪指数品种（股票、债券、商品、QDII 等），我们的处理策略如下：

- Code 字段非空：优先使用 `traced_index_code` 作为合并的唯一键值，如图中绿色框中的ETF。
- Code 为空但 Name 非空：退而求其次使用 `traced_index_name` 作为键值，如图中蓝色框中的ETF。*注：考虑到可能存在名称略微差异但底层指数相同的情况，这部分逻辑未来仍有精进空间。*
- 两者均为空：目前观察到仅出现在商品黄金类的 ETF 中（图中橘黄色框中的），对此类特殊标的采用硬编码方式进行兜底处理。*后期可优化*

通过上述逻辑，我们提取出每个独立的指数及其对应的 ETF 集合。随后，在每个集合内部保留**上市时间最早**的 ETF（若上市时间相同，则保留代码编号较大者）作为该指数的代表，从而完成预过滤。

### 其他优化项

除了核心过滤逻辑的升级，本次迭代还包含以下细节优化：

1. 执行顺序调整：将“按成交额过滤”的步骤提前，在进入核心计算前剔除流动性不足的品种，提升整体运行效率。
2. 可视化增强：对桑基图的显示逻辑进行了优化，现在鼠标悬停在节点处时，能够清晰显示该聚类簇中包含的所有 ETF 名称。

本次更新属于功能性的“小补丁”，相关的修改代码已整理并存放在附件中。无需重新搭建研究环境，只需替换原有文件即可。希望这次微调能为大家的策略研究带来帮助，也欢迎各位交流反馈，点赞支持！